// WebOpenGL.js
(function(){function executeScript(){
Type.registerNamespace('SystemEx.Interop.OpenGL');SystemEx.Interop.OpenGL.$create__WebGLBufferData=function(){return {};}
SystemEx.Interop.OpenGL.WebGL15ContextImpl=function(canvas){this.$24=new Array(4);this.$27=new Array(2);this.$28=new Array(2);this.$2A=new Array(0);this.$2B=new Array(0);this.$2C=new Array(0);this.$2D=new Array(0);SystemEx.Interop.OpenGL.WebGL15ContextImpl.initializeBase(this,[canvas.width,canvas.height]);this.$2E=canvas;this.gl=canvas.getContextWebGL();if(this.gl==null){throw new Error('UnsupportedOperationException: WebGL N/A');}this.$2F();this.$1B('initShader');this.$29=this.gl.createBuffer();this.$1B('createBuffer f. elements');for(var $0=0;$0<this.$24.length;$0++){var $1=SystemEx.Interop.OpenGL.$create__WebGLBufferData();$1.$0=null;$1.$1=this.gl.createBuffer();this.$1B('createBuffer'+$0);$1.$2=0;$1.$3=0;$1.$4=0;$1.$5=0;$1.$6=false;this.$24[$0]=$1;}}
SystemEx.Interop.OpenGL.WebGL15ContextImpl.prototype={$19:0,$1A:function($p0){if(this.$19>=1000){return;}console.log(this.$19+++': '+$p0);},$1B:function($p0){var $0=this.gl.getError();if($0!==GLES20.nO_ERROR){this.$1A('GL_ERROR in '+$p0+'(): '+$0);}},$1D:null,$1E:null,$1F:null,$20:null,$21:null,$22:null,$23:null,gl:null,$25:0,$26:0,$29:null,$2E:null,$2F:function(){var $0=this.$30(GLES20.verteX_SHADER,'\r\n        attribute vec4 a_position;\r\n        attribute vec4 a_color;\r\n        attribute vec2 a_texCoord0;\r\n        attribute vec2 a_texCoord1;\r\n        uniform mat4 u_mvpMatrix;\r\n        varying vec4 v_color;\r\n        varying vec2 v_texCoord0;\r\n        varying vec2 v_texCoord1;\r\n        void main()\r\n        {\r\n            gl_Position = u_mvpMatrix * a_position;\r\n            v_color = a_color;\r\n            v_texCoord0 = a_texCoord0;\r\n            v_texCoord1 = a_texCoord1;\r\n        }');var $1=this.$30(GLES20.fragmenT_SHADER,'\r\n        #ifdef GL_ES\r\n        precision mediump float;\r\n        #endif\r\n        uniform sampler2D s_texture0;\r\n        uniform sampler2D s_texture1;\r\n        uniform int s_texEnv0;\r\n        uniform int s_texEnv1;\r\n        uniform int u_enable_texture_0;\r\n        uniform int u_enable_texture_1;\r\n        varying vec4 v_color;\r\n        varying vec2 v_texCoord0;\r\n        varying vec2 v_texCoord1;\r\n        vec4 finalColor;\r\n        void main()\r\n        {\r\n            finalColor = v_color;\r\n            if (u_enable_texture_0 == 1)\r\n            {\r\n                vec4 texel = texture2D(s_texture0, v_texCoord0);\r\n                if (s_texEnv0 == 1) {\r\n                    finalColor = finalColor * texel;\r\n                } else if (s_texEnv0 == 2) {\r\n                    finalColor = vec4(texel.r, texel.g, texel.b, finalColor.a);\r\n                } else {\r\n                    finalColor = texel;\r\n                }\r\n            }\r\n            if (u_enable_texture_1 == 1) {\r\n                vec4 texel = texture2D(s_texture1, v_texCoord1);\r\n                if (s_texEnv1 == 1) {\r\n                    finalColor = finalColor * texel;\r\n                } else if (s_texEnv1 == 2) {\r\n                    finalColor = vec4(texel.r, texel.g, texel.b, finalColor.a);\r\n                } else {\r\n                    finalColor = texel;\r\n                }\r\n            }\r\n            // simple alpha check\r\n            if (finalColor.a == 0.0) {\r\n                discard;\r\n            }\r\n            float gamma = 1.5;\r\n            float igamma = 1.0 / gamma;\r\n            gl_FragColor = vec4(pow(finalColor.r, igamma), pow(finalColor.g, igamma), pow(finalColor.b, igamma), finalColor.a);\r\n        }');if(($0==null)||($1==null)){throw new Error('RuntimeException: shader error');}var $2=this.gl.createProgram();if(($2==null)||(this.gl.getError()!==GLES20.nO_ERROR)){throw new Error('RuntimeException: program error');}this.gl.attachShader($2,$0);this.gl.attachShader($2,$1);this.gl.bindAttribLocation($2,0,'a_position');this.gl.bindAttribLocation($2,1,'a_color');this.gl.bindAttribLocation($2,2,'a_texCoord0');this.gl.bindAttribLocation($2,3,'a_texCoord1');this.gl.linkProgram($2);this.$1D=this.gl.getUniformLocation($2,'u_mvpMatrix');this.$1E=this.gl.getUniformLocation($2,'s_texture0');this.$1F=this.gl.getUniformLocation($2,'s_texture1');this.$20=this.gl.getUniformLocation($2,'s_texEnv0');this.$21=this.gl.getUniformLocation($2,'s_texEnv1');this.$22=this.gl.getUniformLocation($2,'u_enable_texture_0');this.$23=this.gl.getUniformLocation($2,'u_enable_texture_1');var $3=this.gl.getProgramParameter($2,GLES20.linK_STATUS);if(!$3){throw new Error('RuntimeException: linker Error: '+this.gl.getProgramInfoLog($2));}this.gl.useProgram($2);this.gl.uniform1i(this.$1E,0);this.gl.uniform1i(this.$1F,1);this.gl.activeTexture(GLES20.texturE0);},$30:function($p0,$p1){var $0=this.gl.createShader($p0);if($0==null){throw new Error('RuntimeException:');}this.gl.shaderSource($0,$p1);this.gl.compileShader($0);var $1=this.gl.getShaderParameter($0,GLES20.compilE_STATUS);if(!$1){throw new Error('RuntimeException: Shader compile error: '+this.gl.getShaderInfoLog($0));}return $0;},$31:function($p0){return ((this.$28[$p0]===GLES20.REPLACE)?0:((this.$2C[this.$27[$p0]]===3)?2:1));},$32:function($p0,$p1,$p2){var $0=this.$24[2];this.gl.bindBuffer(GLES20.arraY_BUFFER,$0.$1);var $1=$p0.get_position();var $2=$p0.get_length();$p0.set_position($1+$p1);$p0.setLength($1+$p1+$p2);this.gl.bufferSubData(GLES20.arraY_BUFFER,$p1*4,this.$36($p0,GLES20.FLOAT));$p0.set_position($1);$p0.setLength($2);},$33:function(){if(this.updateMvpMatrix()){this.gl.uniformMatrix4fv(this.$1D,false,this._mvpMatrix);this.$1B('prepareDraw');}this.gl.uniform1i(this.$20,this.$31(0));this.gl.uniform1i(this.$21,this.$31(1));for(var $0=0;$0<4;$0++){var $1=this.$24[$0];if($1.$0!=null){this.gl.bindBuffer(GLES20.arraY_BUFFER,$1.$1);this.$1B('bindBuffer'+$0);this.gl.bufferData(GLES20.arraY_BUFFER,$1.$0,GLES20.streaM_DRAW);this.$1B('bufferData'+$0);this.gl.vertexAttribPointer($0,$1.$3,$1.$4,$1.$6,$1.$2,0);this.$1B('vertexAttribPointer');$1.$0=null;}}},$34:function($p0,$p1,$p2,$p3,$p4,$p5){var $0=this.$24[$p0];$0.$2=$p4;$0.$3=$p1;$0.$6=$p3;$0.$4=$p2;$0.$0=this.$36($p5,$p2);},$35:function($p0,$p1,$p2,$p3,$p4,$p5,$p6,$p7){var $0=this.$2A[$p7];if($0==null){this.$2A[$p7]=$0=this.gl.createBuffer();this.gl.bindBuffer(GLES20.arraY_BUFFER,$0);this.gl.bufferData(GLES20.arraY_BUFFER,this.$36($p6,$p2),GLES20.statiC_DRAW);this.$1B('bufferData');}this.gl.bindBuffer(GLES20.arraY_BUFFER,$0);this.gl.vertexAttribPointer($p0,$p1,$p2,$p3,$p4,$p5);this.$1B('vertexAttribPointer');this.$24[$p0].$0=null;},$36:function($p0,$p1){var $0=(Type.safeCast($p0,SystemEx.IO.MemoryStream));var $1=null;var $2=($p0.get_length()-$p0.get_position());var $3=0;switch($p1){case GLES20.FLOAT:return new Float32Array($1.buffer,$3,$2/4);case GLES20.unsigneD_BYTE:return new Uint8Array($1.buffer,$3,$2);case GLES20.unsigneD_SHORT:return new Uint16Array($1.buffer,$3,$2/2);case GLES20.INT:return new Int32Array($1.buffer,$3,$2/4);case GLES20.SHORT:return new Int16Array($1.buffer,$3,$2/2);case GLES20.BYTE:return new Int8Array($1.buffer,$3,$2);}throw new Error('IllegalArgumentException:');},clientActiveTexture:function(texture){this.$25=texture-GLES20.texturE0;},cullFace:function(mode){this.gl.cullFace(mode);this.$1B('glCullFace');},pointSize:function(size){},polygonMode:function(face,mode){},scissor:function(x,y,width,height){this.gl.scissor(x,y,width,height);this.$1B('glScissor');},texParameterf:function(target,pname,param){this.gl.texParameterf(target,pname,param);this.$1B('glTexParameterf');},texParameterfv:function(target,pname,s){},texParameteri:function(target,pname,param){this.gl.texParameteri(target,pname,param);this.$1B('glTexParameteri');},texParameteriv:function(target,pname,s){},texImage2D:function(target,level,internalformat,width,height,border,format,type,pixels){this.$2D[this.$27[this.$26]]=internalformat;this.gl.texImage2D(target,level,internalformat,width,height,border,format,type,this.$36(pixels,type));this.$1B('glTexImage2D');},texImage2Di:function(target,level,internalformat,format,type,image){this.gl.texImage2D(target,level,internalformat,format,type,image);this.$1B('texImage2D');},texImage2De:function(target,level,internalformat,format,type,canvas){this.gl.texImage2D(target,level,internalformat,format,type,canvas);this.$1B('texImage2D');},texImage2Dex:function(target,level,internalformat,format,type,canvas){this.gl.texImage2D(target,level,internalformat,format,type,canvas);this.$1B('texImage2D');},drawBuffer:function(mode){},clear:function(mask){this.gl.clear(mask);this.$1B('glClear');},clearColor:function(red,green,blue,alpha){this.gl.clearColor(red,green,blue,alpha);this.$1B('glClearColor');},depthMask:function(flag){this.gl.depthMask(flag);this.$1B('glDepthMask');},disable:function(cap){if(cap!==3553){this.gl.disable(cap);this.$1B('glDisable');return;}switch(this.$26){case 0:this.gl.uniform1i(this.$22,0);break;case 1:this.gl.uniform1i(this.$23,0);break;default:throw new Error('RuntimeException:');}},enable:function(cap){if(cap!==3553){this.gl.enable(cap);this.$1B('glEnable');return;}switch(this.$26){case 0:this.gl.uniform1i(this.$22,1);break;case 1:this.gl.uniform1i(this.$23,1);break;default:throw new Error('RuntimeException:');}},finish:function(){this.gl.finish();},blendFunc:function(sfactor,dfactor){this.gl.blendFunc(sfactor,dfactor);this.$1B('glBlendFunc');},depthFunc:function(func){this.gl.depthFunc(func);this.$1B('glDepthFunc');},pixelStorei:function(pname,param){this.gl.pixelStorei(pname,param);},readPixels:function(x,y,width,height,format,type,pixels){},getError:function(){return this.gl.getError();},getString:function(name){return 'glGetString not implemented';},depthRange:function(zNear,zFar){this.gl.depthRange(zNear,zFar);this.$1B('glDepthRangef');},viewport:function(x,y,width,height){SystemEx.Interop.OpenGL.WebGL15ContextImpl.callBaseMethod(this, 'viewport',[x,y,width,height]);this.gl.viewport(x,y,width,height);this.$1B('glViewport');},shadeModel:function(mode){},texEnvi:function(target,pname,param){this.$28[this.$26]=param;},texEnviv:function(target,pname,pparams){},drawArrays:function(mode,first,count){this.$33();this.gl.drawArrays(mode,first,count);this.$1B('drawArrays');},drawElements:function(mode,count,type,indicies){this.$33();this.gl.bindBuffer(34963,this.$29);this.$1B('bindBuffer(el)');this.gl.bufferData(34963,this.$36(indicies,5123),35048);this.$1B('bufferData(el)');this.gl.drawElements(mode,count,5123,0);this.$1B('drawElements');},texSubImage2D:function(target,level,xoffset,yoffset,width,height,format,type,pixels){this.gl.texSubImage2D(target,level,xoffset,yoffset,width,height,format,type,this.$36(pixels,type));this.$1B('glTexSubImage2D');},bindTexture:function(target,texture){var $0=this.$2B[texture];if($0==null){$0=this.gl.createTexture();this.$2B[texture]=$0;}this.gl.bindTexture(target,$0);this.$1B('glBindTexture');this.$27[this.$26]=texture;},deleteTextures:function(n,textures){for(var $0=0;$0<n;$0++){var $1=SystemEx.IO.SE.readInt32(textures);this.gl.deleteTexture(this.$2B[$1]);this.$1B('glDeleteTexture');this.$2B[$1]=null;}},color4f:function(red,green,blue,alpha){this.gl.vertexAttrib4f(1,red,green,blue,alpha);this.$1B('glColor4f');},colorPointer:function(size,type,stride,pointer){this.$34(1,size,type,true,stride,pointer);this.$1B('glColorPointer');},disableClientState:function(array){switch(array){case 32886:this.gl.disableVertexAttribArray(1);this.$1B('DisableClientState colorArr');break;case 32884:this.gl.disableVertexAttribArray(0);this.$1B('DisableClientState vertexArrr');break;case 32888:switch(this.$25){case 0:this.gl.disableVertexAttribArray(2);this.$1B('DisableClientState texCoord0');break;case 1:this.gl.disableVertexAttribArray(3);this.$1B('DisableClientState texCoord1');break;default:throw new Error('RuntimeException:');}break;default:this.$1A('unsupported / unrecogized client state');break;}},enableClientState:function(array){switch(array){case 32886:this.gl.enableVertexAttribArray(1);this.$1B('enableClientState colorArr');break;case 32884:this.gl.enableVertexAttribArray(0);this.$1B('enableClientState vertexArrr');break;case 32888:switch(this.$25){case 0:this.gl.enableVertexAttribArray(2);this.$1B('enableClientState texCoord0');break;case 1:this.gl.enableVertexAttribArray(3);this.$1B('enableClientState texCoord1');break;default:throw new Error('RuntimeException:');}break;default:this.$1A('unsupported / unrecogized client state '+array);break;}},texCoordPointer:function(size,type,stride,pointer){this.$34(2+this.$25,size,type,false,stride,pointer);this.$1B('texCoordPointer');},vertexPointer:function(size,type,stride,pointer){this.$34(0,size,type,false,stride,pointer);this.$1B('glVertexPointer');},activeTexture:function(texture){this.gl.activeTexture(texture);this.$1B('glActiveTexture');this.$26=texture-33984;},pointParameterf:function(pname,param){},pointParameterfv:function(pname,s){}}
SystemEx.Interop.OpenGL.WebGL15Context=function(width,height){this.$2=new SystemEx.IO.MemoryStream(new Array(SystemEx.Interop.OpenGL.WebGL15Context.$0*2*4));this.$3=new SystemEx.IO.MemoryStream(new Array(SystemEx.Interop.OpenGL.WebGL15Context.$0*3*4));this.$4=new SystemEx.IO.MemoryStream(new Array(8*4));this.$6=5888;this.$B=new Array(16);this.$C=new Array(16);this.$D=new Array(16);this.$F=[];this.$10=[];this.$11=[];this.$13=new Array(16);this._mvpMatrix=new Array(16);SystemEx.IO.SE.writeSingle(this.$4,0);SystemEx.IO.SE.writeSingle(this.$4,0);SystemEx.IO.SE.writeSingle(this.$4,1);SystemEx.IO.SE.writeSingle(this.$4,0);SystemEx.IO.SE.writeSingle(this.$4,1);SystemEx.IO.SE.writeSingle(this.$4,1);SystemEx.IO.SE.writeSingle(this.$4,0);SystemEx.IO.SE.writeSingle(this.$4,1);this.$4.set_position(0);SystemEx.MathMatrix.setIdentityM(this.$C,0);SystemEx.MathMatrix.setIdentityM(this.$B,0);SystemEx.MathMatrix.setIdentityM(this.$D,0);this.$15=width;this.$16=height;}
SystemEx.Interop.OpenGL.WebGL15Context.prototype={$1:0,$5:0,$7:0,$8:0,$9:0,$A:0,$E:null,$12:null,$14:true,$15:0,$16:0,updateMvpMatrix:function(){if(!this.$14){return false;}SystemEx.MathMatrix.multiplyMM(this._mvpMatrix,0,this.$B,0,this.$C,0);this.$14=false;return true;},$17:function($p0,$p1,$p2,$p3,$p4){var $0=[$p0,$p1,$p2,1];var $1=new Array(4);SystemEx.MathMatrix.multiplyMV($1,0,this._mvpMatrix,0,$0,0);var $2=$1[3];if($2===0){return false;}var $3=1/$2;$p4[0]=this.$7+this.$9*($1[0]*$3+1)*0.5;$p4[1]=this.$8+this.$A*($1[1]*$3+1)*0.5;$p4[2]=($1[2]*$3+1)*0.5;return true;},$18:function($p0,$p1,$p2,$p3,$p4,$p5,$p6,$p7){var $0=$p6;if(($p2===5120)||($p2===5121)){var $1=$0.get_position();$0.set_position($1+$p5);if($p0!==1){throw new Error('InvalidOperationException:');}this.colorPointer($p1,$p2,$p4,$0);$0.set_position($1);}else if($p2===5126){var $2=$0.get_position();$0.set_position($2+$p5/4);switch($p0){case 1:this.colorPointer($p1,$p2,$p4,$0);break;case 0:this.vertexPointer($p1,$p2,$p4,$0);break;case 2:case 3:this.texCoordPointer($p1,$p2,$p4,$0);break;default:throw new Error('ArgumentException: nioBuffer');}$0.set_position($2);}},getFloatv:function(pname,s){switch(pname){case 5888:case 2982:var $0=s.get_position();for(var $1=0;$1<this.$C.length;$1++){SystemEx.IO.SE.writeSingle(s,this.$C[$1]);}s.set_position($0);break;default:throw new Error('ArgumentException: glGetFloat');}},getIntegerv:function(pname,s){switch(pname){case 2976:SystemEx.IO.SE.writeUInt32(s,this.$6);break;default:throw new Error('ArgumentException:');}},viewport:function(x,y,width,height){this.$7=x;this.$8=y;this.$9=width;this.$A=height;},begin:function(mode){this.$1=mode;this.$3.setLength(0);this.$2.setLength(0);},color3f:function(red,green,blue){this.color4f(red,green,blue,1);},color3ub:function(red,green,blue){this.color4ub(red,green,blue,255);},color4ub:function(red,green,blue,alpha){this.color4f((red&255)/255,(green&255)/255,(blue&255)/255,(alpha&255)/255);},end:function(){var $0=this.$3.get_position()/3;this.$3.set_position(0);this.enableClientState(32884);this.vertexPointer(3,0,0,this.$3);if(this.$1===4294967295){this.enableClientState(32888);this.$18(2,2,5126,false,0,0,this.$4,this.$5);this.texCoordPointer(2,5126,0,this.$4);this.drawArrays(6,0,4);}else{if(this.$2.get_position()>0){this.$2.set_position(0);this.enableClientState(32888);this.texCoordPointer(2,5126,0,this.$2);}if(this.$1===7){for(var $1=0;$1<$0;$1+=4){this.drawArrays(6,$1,4);}}else{this.drawArrays(this.$1,0,$0);}}},texCoord2f:function(s,t){SystemEx.IO.SE.writeSingle(this.$2,s);SystemEx.IO.SE.writeSingle(this.$2,t);},vertex2f:function(x,y){this.vertex3f(x,y,0);},vertex3f:function(x,y,z){SystemEx.IO.SE.writeSingle(this.$3,x);SystemEx.IO.SE.writeSingle(this.$3,y);SystemEx.IO.SE.writeSingle(this.$3,z);},alphaFunc:function(func,rref){},frustum:function(left,right,bottom,top,zNear,zFar){var $0=2*zNear;var $1=right-left;var $2=top-bottom;var $3=zFar-zNear;var $4=[($0/$1),0,0,0,0,($0/$2),0,0,((right+left)/$1),((top+bottom)/$2),((-zFar-zNear)/$3),-1,0,0,((-$0*zFar)/$3),0];this.multMatrixf($4);},loadIdentity:function(){SystemEx.MathMatrix.setIdentityM(this.$E,0);this.$14=true;},loadMatrixf:function(s){var $0=s.get_position();for(var $1=0;$1<this.$E.length;$1++){this.$E[$1]=SystemEx.IO.SE.readSingle(s);}s.set_position($0);this.$14=true;},matrixMode:function(mode){switch(mode){case 5888:this.$E=this.$C;this.$12=this.$10;break;case 5889:this.$E=this.$B;this.$12=this.$F;break;case 5890:this.$E=this.$D;this.$12=this.$11;break;default:throw new Error('ArgumentException: Unrecoginzed matrix mode: '+mode);}this.$6=mode;},multMatrixf:function(m){var $0=0;SystemEx.MathMatrix.multiplyMM(this.$13,0,this.$E,0,m,$0);SystemEx.JSArrayEx.copy(this.$13,0,this.$E,0,16);this.$14=true;},ortho:function(left,right,bottom,top,zNear,zFar){var $0=[2/(right-left),0,0,0,0,2/(top-bottom),0,0,0,0,-2/(zFar-zNear),0,-(right+left)/(right-left),-(top+bottom)/(top-bottom),-(zFar+zNear)/(zFar-zNear),1];this.multMatrixf($0);this.$14=true;},orthox_:function(left,right,bottom,top,zNear,zFar){var $0=left;var $1=right;var $2=bottom;var $3=zNear;var $4=zFar;var $5=top;var $6=[2/($1-$0),0,0,0,0,2/($5-$2),0,0,0,0,-2/($4-$3),0,-($1+$0)/($1-$0),-($5+$2)/($5-$2),-($4+$3)/($4-$3),1];this.multMatrixf($6);this.$14=true;},popMatrix:function(){var $0=this.$12.pop();SystemEx.JSArrayEx.copy($0,0,this.$E,0,16);this.$14=true;},pushMatrix:function(){var $0=new Array(16);SystemEx.JSArrayEx.copy(this.$E,0,$0,0,16);this.$12.push($0);},rotatef:function(angle,x,y,z){if((!!x)||(!!y)||(!!z)){SystemEx.MathMatrix.rotateM2(this.$E,0,angle,x,y,z);}this.$14=true;},scalef:function(x,y,z){SystemEx.MathMatrix.scaleM2(this.$E,0,x,y,z);this.$14=true;},scalex_:function(x,y,z){SystemEx.MathMatrix.scaleM2(this.$E,0,x,y,z);this.$14=true;},translatef:function(x,y,z){SystemEx.MathMatrix.translateM2(this.$E,0,x,y,z);this.$14=true;},translatex_:function(x,y,z){SystemEx.MathMatrix.translateM2(this.$E,0,x,y,z);this.$14=true;}}
SystemEx.Interop.OpenGL.WebGLES11RenderingContextImpl=function(canvas){this.$2_1C=new Array(4);this.$2_1F=new Array(2);this.$2_20=new Array(2);this.$2_22=new Array(0);this.$2_23=new Array(0);this.$2_24=new Array(0);this.$2_25=new Array(0);SystemEx.Interop.OpenGL.WebGLES11RenderingContextImpl.initializeBase(this,[canvas.width,canvas.height]);this.$2_26=canvas;this.gl=canvas.getContextWebGL();if(this.gl==null){throw new Error('UnsupportedOperationException: WebGL N/A');}this.$2_27();this.$2_13('initShader');this.$2_21=this.gl.createBuffer();this.$2_13('createBuffer f. elements');for(var $0=0;$0<this.$2_1C.length;$0++){var $1=SystemEx.Interop.OpenGL.$create__WebGLBufferData();$1.$0=null;$1.$1=this.gl.createBuffer();this.$2_13('createBuffer'+$0);$1.$2=0;$1.$3=0;$1.$4=0;$1.$5=0;$1.$6=false;this.$2_1C[$0]=$1;}}
SystemEx.Interop.OpenGL.WebGLES11RenderingContextImpl.prototype={$2_11:0,$2_12:function($p0){if(this.$2_11>=1000){return;}console.log(this.$2_11+++': '+$p0);},$2_13:function($p0){var $0=this.gl.getError();if($0!==GLES20.nO_ERROR){this.$2_12('GL_ERROR in '+$p0+'(): '+$0);}},$2_15:null,$2_16:null,$2_17:null,$2_18:null,$2_19:null,$2_1A:null,$2_1B:null,gl:null,$2_1D:0,$2_1E:0,$2_21:null,$2_26:null,$2_27:function(){var $0=this.$2_28(GLES20.verteX_SHADER,'\r\n        attribute vec4 a_position;\r\n        attribute vec4 a_color;\r\n        attribute vec2 a_texCoord0;\r\n        attribute vec2 a_texCoord1;\r\n        uniform mat4 u_mvpMatrix;\r\n        varying vec4 v_color;\r\n        varying vec2 v_texCoord0;\r\n        varying vec2 v_texCoord1;\r\n        void main()\r\n        {\r\n            gl_Position = u_mvpMatrix * a_position;\r\n            v_color = a_color;\r\n            v_texCoord0 = a_texCoord0;\r\n            v_texCoord1 = a_texCoord1;\r\n        }');var $1=this.$2_28(GLES20.fragmenT_SHADER,'\r\n        #ifdef GL_ES\r\n        precision mediump float;\r\n        #endif\r\n        uniform sampler2D s_texture0;\r\n        uniform sampler2D s_texture1;\r\n        uniform int s_texEnv0;\r\n        uniform int s_texEnv1;\r\n        uniform int u_enable_texture_0;\r\n        uniform int u_enable_texture_1;\r\n        varying vec4 v_color;\r\n        varying vec2 v_texCoord0;\r\n        varying vec2 v_texCoord1;\r\n        vec4 finalColor;\r\n        void main()\r\n        {\r\n            finalColor = v_color;\r\n            if (u_enable_texture_0 == 1)\r\n            {\r\n                vec4 texel = texture2D(s_texture0, v_texCoord0);\r\n                if (s_texEnv0 == 1) {\r\n                    finalColor = finalColor * texel;\r\n                } else if (s_texEnv0 == 2) {\r\n                    finalColor = vec4(texel.r, texel.g, texel.b, finalColor.a);\r\n                } else {\r\n                    finalColor = texel;\r\n                }\r\n            }\r\n            if (u_enable_texture_1 == 1) {\r\n                vec4 texel = texture2D(s_texture1, v_texCoord1);\r\n                if (s_texEnv1 == 1) {\r\n                    finalColor = finalColor * texel;\r\n                } else if (s_texEnv1 == 2) {\r\n                    finalColor = vec4(texel.r, texel.g, texel.b, finalColor.a);\r\n                } else {\r\n                    finalColor = texel;\r\n                }\r\n            }\r\n            // simple alpha check\r\n            if (finalColor.a == 0.0) {\r\n                discard;\r\n            }\r\n            float gamma = 1.5;\r\n            float igamma = 1.0 / gamma;\r\n            gl_FragColor = vec4(pow(finalColor.r, igamma), pow(finalColor.g, igamma), pow(finalColor.b, igamma), finalColor.a);\r\n        }');if(($0==null)||($1==null)){throw new Error('RuntimeException: shader error');}var $2=this.gl.createProgram();if(($2==null)||(this.gl.getError()!==GLES20.nO_ERROR)){throw new Error('RuntimeException: program error');}this.gl.attachShader($2,$0);this.gl.attachShader($2,$1);this.gl.bindAttribLocation($2,0,'a_position');this.gl.bindAttribLocation($2,1,'a_color');this.gl.bindAttribLocation($2,2,'a_texCoord0');this.gl.bindAttribLocation($2,3,'a_texCoord1');this.gl.linkProgram($2);this.$2_15=this.gl.getUniformLocation($2,'u_mvpMatrix');this.$2_16=this.gl.getUniformLocation($2,'s_texture0');this.$2_17=this.gl.getUniformLocation($2,'s_texture1');this.$2_18=this.gl.getUniformLocation($2,'s_texEnv0');this.$2_19=this.gl.getUniformLocation($2,'s_texEnv1');this.$2_1A=this.gl.getUniformLocation($2,'u_enable_texture_0');this.$2_1B=this.gl.getUniformLocation($2,'u_enable_texture_1');var $3=this.gl.getProgramParameter($2,GLES20.linK_STATUS);if(!$3){throw new Error('RuntimeException: linker Error: '+this.gl.getProgramInfoLog($2));}this.gl.useProgram($2);this.gl.uniform1i(this.$2_16,0);this.gl.uniform1i(this.$2_17,1);this.gl.activeTexture(GLES20.texturE0);},$2_28:function($p0,$p1){var $0=this.gl.createShader($p0);if($0==null){throw new Error('RuntimeException:');}this.gl.shaderSource($0,$p1);this.gl.compileShader($0);var $1=this.gl.getShaderParameter($0,GLES20.compilE_STATUS);if(!$1){throw new Error('RuntimeException: Shader compile error: '+this.gl.getShaderInfoLog($0));}return $0;},clearColor:function(red,green,blue,alpha){this.gl.clearColor(red,green,blue,alpha);this.$2_13('glClearColor');},color4f:function(red,green,blue,alpha){this.gl.vertexAttrib4f(1,red,green,blue,alpha);this.$2_13('glColor4f');},depthRangef:function(zNear,zFar){this.gl.depthRange(zNear,zFar);this.$2_13('glDepthRangef');},pointParameterf:function(pname,param){},pointParameterfv:function(pname,pparams){},pointSize:function(size){},texParameterf:function(target,pname,param){this.gl.texParameterf(target,pname,param);this.$2_13('glTexParameterf');},texParameterfv:function(target,pname,pparams){},activeTexture:function(texture){this.gl.activeTexture(texture);this.$2_13('glActiveTexture');this.$2_1E=texture-GLES20.texturE0;},bindTexture:function(target,texture){var $0=this.$2_23[texture];if($0==null){$0=this.gl.createTexture();this.$2_23[texture]=$0;}this.gl.bindTexture(target,$0);this.$2_13('glBindTexture');this.$2_1F[this.$2_1E]=texture;},blendFunc:function(sfactor,dfactor){this.gl.blendFunc(sfactor,dfactor);this.$2_13('glBlendFunc');},clear:function(mask){this.gl.clear(mask);this.$2_13('glClear');},clientActiveTexture:function(texture){this.$2_1D=texture-GLES20.texturE0;},colorPointer:function(size,type,stride,pointer){this.$2_2D(1,size,type,true,stride,pointer);this.$2_13('glColorPointer');},cullFace:function(mode){this.gl.cullFace(mode);this.$2_13('glCullFace');},deleteTextures:function(n,textures){for(var $0=0;$0<n;$0++){var $1=SystemEx.IO.SE.readInt32(textures);this.gl.deleteTexture(this.$2_23[$1]);this.$2_13('glDeleteTexture');this.$2_23[$1]=null;}},depthFunc:function(func){this.gl.depthFunc(func);this.$2_13('glDepthFunc');},depthMask:function(flag){this.gl.depthMask(flag);this.$2_13('glDepthMask');},depthRangex:function(zNear,zFar){this.gl.depthRange(zNear,zFar);this.$2_13('glDepthRangex');},disable:function(cap){if(cap!==GLES20.texturE_2D){this.gl.disable(cap);this.$2_13('glDisable');return;}switch(this.$2_1E){case 0:this.gl.uniform1i(this.$2_1A,0);break;case 1:this.gl.uniform1i(this.$2_1B,0);break;default:throw new Error('RuntimeException:');}},disableClientState:function(array){switch(array){case 32886:this.gl.disableVertexAttribArray(1);this.$2_13('DisableClientState colorArr');break;case 32884:this.gl.disableVertexAttribArray(0);this.$2_13('DisableClientState vertexArrr');break;case 32888:switch(this.$2_1D){case 0:this.gl.disableVertexAttribArray(2);this.$2_13('DisableClientState texCoord0');break;case 1:this.gl.disableVertexAttribArray(3);this.$2_13('DisableClientState texCoord1');break;default:throw new Error('RuntimeException:');}break;default:this.$2_12('unsupported / unrecogized client state');break;}},drawArrays:function(mode,first,count){this.$2_2C();this.gl.drawArrays(mode,first,count);this.$2_13('drawArrays');},drawElements:function(mode,count,type,indicies){this.$2_2C();this.gl.bindBuffer(GLES20.elemenT_ARRAY_BUFFER,this.$2_21);this.$2_13('bindBuffer(el)');this.gl.bufferData(GLES20.elemenT_ARRAY_BUFFER,this.$2_2F(indicies,GLES20.unsigneD_SHORT),GLES20.dynamiC_DRAW);this.$2_13('bufferData(el)');this.gl.drawElements(mode,count,GLES20.unsigneD_SHORT,0);this.$2_13('drawElements');},enable:function(cap){if(cap!==GLES20.texturE_2D){this.gl.enable(cap);this.$2_13('glEnable');return;}switch(this.$2_1E){case 0:this.gl.uniform1i(this.$2_1A,1);break;case 1:this.gl.uniform1i(this.$2_1B,1);break;default:throw new Error('RuntimeException:');}},enableClientState:function(array){switch(array){case 32886:this.gl.enableVertexAttribArray(1);this.$2_13('enableClientState colorArr');break;case 32884:this.gl.enableVertexAttribArray(0);this.$2_13('enableClientState vertexArrr');break;case 32888:switch(this.$2_1D){case 0:this.gl.enableVertexAttribArray(2);this.$2_13('enableClientState texCoord0');break;case 1:this.gl.enableVertexAttribArray(3);this.$2_13('enableClientState texCoord1');break;default:throw new Error('RuntimeException:');}break;default:this.$2_12('unsupported / unrecogized client state '+array);break;}},finish:function(){this.gl.finish();},getError:function(){return this.gl.getError();},getString:function(name){return 'glGetString not implemented';},pixelStorei:function(pname,param){this.gl.pixelStorei(pname,param);},pointParameterx:function(pname,param){},pointParameterxv:function(pname,pparams){},pointSizex:function(size){},readPixels:function(x,y,width,height,format,type,pixels){},scissor:function(x,y,width,height){this.gl.scissor(x,y,width,height);this.$2_13('glScissor');},shadeModel:function(mode){},texCoordPointer:function(size,type,stride,pointer){this.$2_2D(2+this.$2_1D,size,type,false,stride,pointer);this.$2_13('texCoordPointer');},texEnvi:function(target,pname,param){this.$2_20[this.$2_1E]=param;},texEnvx:function(target,pname,param){this.$2_20[this.$2_1E]=param;},texEnviv:function(target,pname,pparams){},texEnvxv:function(target,pname,pparams){},texImage2D:function(target,level,internalformat,width,height,border,format,type,pixels){this.$2_25[this.$2_1F[this.$2_1E]]=internalformat;this.gl.texImage2D(target,level,internalformat,width,height,border,format,type,this.$2_2F(pixels,type));this.$2_13('glTexImage2D');},texImage2Di:function(target,level,internalformat,format,type,image){this.gl.texImage2D(target,level,internalformat,format,type,image);this.$2_13('texImage2D');},texImage2De:function(target,level,internalformat,format,type,canvas){this.gl.texImage2D(target,level,internalformat,format,type,canvas);this.$2_13('texImage2D');},texImage2Dx:function(target,level,internalformat,format,type,canvas){this.gl.texImage2D(target,level,internalformat,format,type,canvas);this.$2_13('texImage2D');},texParameteri:function(target,pname,param){this.gl.texParameteri(target,pname,param);this.$2_13('glTexParameteri');},texParameterx:function(target,pname,param){this.gl.texParameteri(target,pname,param);this.$2_13('glTexParameteri');},texParameteriv:function(target,pname,pparams){},texParameterxv:function(target,pname,pparams){},texSubImage2D:function(target,level,xoffset,yoffset,width,height,format,type,pixels){this.gl.texSubImage2D(target,level,xoffset,yoffset,width,height,format,type,this.$2_2F(pixels,type));this.$2_13('glTexSubImage2D');},vertexPointer:function(size,type,stride,pointer){this.$2_2D(0,size,type,false,stride,pointer);this.$2_13('glVertexPointer');},viewport:function(x,y,width,height){SystemEx.Interop.OpenGL.WebGLES11RenderingContextImpl.callBaseMethod(this, 'viewport',[x,y,width,height]);this.gl.viewport(x,y,width,height);this.$2_13('glViewport');},generateMipmap:function(target){this.gl.generateMipmap(target);this.$2_13('genMipmap');},$2_29:function($p0,$p1){},$2_2A:function($p0){return ((this.$2_20[$p0]===GLES20.REPLACE)?0:((this.$2_24[this.$2_1F[$p0]]===3)?2:1));},$2_2B:function($p0,$p1,$p2){var $0=this.$2_1C[2];this.gl.bindBuffer(GLES20.arraY_BUFFER,$0.$1);var $1=$p0.get_position();var $2=$p0.get_length();$p0.set_position($1+$p1);$p0.setLength($1+$p1+$p2);this.gl.bufferSubData(GLES20.arraY_BUFFER,$p1*4,this.$2_2F($p0,GLES20.FLOAT));$p0.set_position($1);$p0.setLength($2);},$2_2C:function(){if(this.updateMvpMatrix()){this.gl.uniformMatrix4fv(this.$2_15,false,this._mvpMatrix);this.$2_13('prepareDraw');}this.gl.uniform1i(this.$2_18,this.$2_2A(0));this.gl.uniform1i(this.$2_19,this.$2_2A(1));for(var $0=0;$0<4;$0++){var $1=this.$2_1C[$0];if($1.$0!=null){this.gl.bindBuffer(GLES20.arraY_BUFFER,$1.$1);this.$2_13('bindBuffer'+$0);this.gl.bufferData(GLES20.arraY_BUFFER,$1.$0,GLES20.streaM_DRAW);this.$2_13('bufferData'+$0);this.gl.vertexAttribPointer($0,$1.$3,$1.$4,$1.$6,$1.$2,0);this.$2_13('vertexAttribPointer');$1.$0=null;}}},$2_2D:function($p0,$p1,$p2,$p3,$p4,$p5){var $0=this.$2_1C[$p0];$0.$2=$p4;$0.$3=$p1;$0.$6=$p3;$0.$4=$p2;$0.$0=this.$2_2F($p5,$p2);},$2_2E:function($p0,$p1,$p2,$p3,$p4,$p5,$p6,$p7){var $0=this.$2_22[$p7];if($0==null){this.$2_22[$p7]=$0=this.gl.createBuffer();this.gl.bindBuffer(GLES20.arraY_BUFFER,$0);this.gl.bufferData(GLES20.arraY_BUFFER,this.$2_2F($p6,$p2),GLES20.statiC_DRAW);this.$2_13('bufferData');}this.gl.bindBuffer(GLES20.arraY_BUFFER,$0);this.gl.vertexAttribPointer($p0,$p1,$p2,$p3,$p4,$p5);this.$2_13('vertexAttribPointer');this.$2_1C[$p0].$0=null;},$2_2F:function($p0,$p1){var $0=(Type.safeCast($p0,SystemEx.IO.MemoryStream));var $1=null;var $2=($p0.get_length()-$p0.get_position());var $3=0;switch($p1){case GLES20.FLOAT:return new Float32Array($1.buffer,$3,$2/4);case GLES20.unsigneD_BYTE:return new Uint8Array($1.buffer,$3,$2);case GLES20.unsigneD_SHORT:return new Uint16Array($1.buffer,$3,$2/2);case GLES20.INT:return new Int32Array($1.buffer,$3,$2/4);case GLES20.SHORT:return new Int16Array($1.buffer,$3,$2/2);case GLES20.BYTE:return new Int8Array($1.buffer,$3,$2);}throw new Error('IllegalArgumentException:');}}
SystemEx.Interop.OpenGL.WebGLES11RenderingContext=function(width,height){this.$2_0=5888;this.$2_5=new Array(16);this.$2_6=new Array(16);this.$2_7=new Array(16);this.$2_9=[];this.$2_A=[];this.$2_B=[];this.$2_D=new Array(16);this._mvpMatrix=new Array(16);SystemEx.Interop.OpenGL.WebGLES11RenderingContext.initializeBase(this);SystemEx.MathMatrix.setIdentityM(this.$2_6,0);SystemEx.MathMatrix.setIdentityM(this.$2_5,0);SystemEx.MathMatrix.setIdentityM(this.$2_7,0);this.$2_F=width;this.$2_10=height;}
SystemEx.Interop.OpenGL.WebGLES11RenderingContext.prototype={$2_1:0,$2_2:0,$2_3:0,$2_4:0,$2_8:null,$2_C:null,$2_E:true,$2_F:0,$2_10:0,alphaFunc:function(func,r){},frustumf:function(left,right,bottom,top,zNear,zFar){var $0=2*zNear;var $1=right-left;var $2=top-bottom;var $3=zFar-zNear;var $4=[($0/$1),0,0,0,0,($0/$2),0,0,((right+left)/$1),((top+bottom)/$2),((-zFar-zNear)/$3),-1,0,0,((-$0*zFar)/$3),0];this.multMatrixf($4);},getFloatv:function(name,s){switch(name){case 5888:case 2982:var $0=s.get_position();for(var $1=0;$1<this.$2_6.length;$1++){SystemEx.IO.SE.writeSingle(s,this.$2_6[$1]);}s.set_position($0);break;default:throw new Error('ArgumentException: glGetFloat');}},loadMatrixf:function(s){var $0=s.get_position();for(var $1=0;$1<this.$2_8.length;$1++){this.$2_8[$1]=SystemEx.IO.SE.readSingle(s);}s.set_position($0);this.$2_E=true;},multMatrixf:function(m){var $0=0;SystemEx.MathMatrix.multiplyMM(this.$2_D,0,this.$2_8,0,m,$0);SystemEx.JSArrayEx.copy(this.$2_D,0,this.$2_8,0,16);this.$2_E=true;},orthof:function(left,right,bottom,top,zNear,zFar){var $0=[2/(right-left),0,0,0,0,2/(top-bottom),0,0,0,0,-2/zFar-zNear,0,-(right+left)/(right-left),-(top+bottom)/(top-bottom),-(zFar+zNear)/(zFar-zNear),1];this.multMatrixf($0);this.$2_E=true;},rotatef:function(angle,x,y,z){if((!!x)||(!!y)||(!!z)){SystemEx.MathMatrix.rotateM2(this.$2_8,0,angle,x,y,z);}this.$2_E=true;},scalef:function(x,y,z){SystemEx.MathMatrix.scaleM2(this.$2_8,0,x,y,z);this.$2_E=true;},translatef:function(x,y,z){SystemEx.MathMatrix.translateM2(this.$2_8,0,x,y,z);this.$2_E=true;},alphaFuncx:function(func,r){},getIntegerv:function(pname,s){switch(pname){case 2976:SystemEx.IO.SE.writeUInt32(s,this.$2_0);break;default:throw new Error('ArgumentException:');}},loadIdentity:function(){SystemEx.MathMatrix.setIdentityM(this.$2_8,0);this.$2_E=true;},loadMatrixx:function(m){var $0=m.get_position();for(var $1=0;$1<this.$2_8.length;$1++){this.$2_8[$1]=SystemEx.IO.SE.readUInt32(m);}m.set_position($0);this.$2_E=true;},matrixMode:function(mode){switch(mode){case 5888:this.$2_8=this.$2_6;this.$2_C=this.$2_A;break;case 5889:this.$2_8=this.$2_5;this.$2_C=this.$2_9;break;case GLES20.TEXTURE:this.$2_8=this.$2_7;this.$2_C=this.$2_B;break;default:throw new Error('ArgumentException: Unrecoginzed matrix mode: '+mode);}this.$2_0=mode;},orthox:function(left,right,bottom,top,zNear,zFar){var $0=left;var $1=right;var $2=bottom;var $3=zNear;var $4=zFar;var $5=top;var $6=[2/($1-$0),0,0,0,0,2/($5-$2),0,0,0,0,-2/$4-$3,0,-($1+$0)/($1-$0),-($5+$2)/($5-$2),-($4+$3)/($4-$3),1];this.multMatrixf($6);this.$2_E=true;},popMatrix:function(){var $0=this.$2_C.pop();SystemEx.JSArrayEx.copy($0,0,this.$2_8,0,16);this.$2_E=true;},pushMatrix:function(){var $0=new Array(16);SystemEx.JSArrayEx.copy(this.$2_8,0,$0,0,16);this.$2_C.push($0);},scalex:function(x,y,z){SystemEx.MathMatrix.scaleM2(this.$2_8,0,x,y,z);this.$2_E=true;},translatex:function(x,y,z){SystemEx.MathMatrix.translateM2(this.$2_8,0,x,y,z);this.$2_E=true;},viewport:function(x,y,width,height){this.$2_1=x;this.$2_2=y;this.$2_3=width;this.$2_4=height;},updateMvpMatrix:function(){if(!this.$2_E){return false;}SystemEx.MathMatrix.multiplyMM(this._mvpMatrix,0,this.$2_5,0,this.$2_6,0);this.$2_E=false;return true;},project:function(objX,objY,objZ,view,win){var $0=[objX,objY,objZ,1];var $1=new Array(4);SystemEx.MathMatrix.multiplyMV($1,0,this._mvpMatrix,0,$0,0);var $2=$1[3];if($2===0){return false;}var $3=1/$2;win[0]=this.$2_1+this.$2_3*($1[0]*$3+1)*0.5;win[1]=this.$2_2+this.$2_4*($1[1]*$3+1)*0.5;win[2]=($1[2]*$3+1)*0.5;return true;}}
SystemEx.Interop.OpenGL.WebGL15Context.registerClass('SystemEx.Interop.OpenGL.WebGL15Context');SystemEx.Interop.OpenGL.WebGL15ContextImpl.registerClass('SystemEx.Interop.OpenGL.WebGL15ContextImpl',SystemEx.Interop.OpenGL.WebGL15Context);SystemEx.Interop.OpenGL.WebGLES11RenderingContext.registerClass('SystemEx.Interop.OpenGL.WebGLES11RenderingContext',WebGLRenderingContext);SystemEx.Interop.OpenGL.WebGLES11RenderingContextImpl.registerClass('SystemEx.Interop.OpenGL.WebGLES11RenderingContextImpl',SystemEx.Interop.OpenGL.WebGLES11RenderingContext);SystemEx.Interop.OpenGL.WebGL15Context.$0=16384;SystemEx.Interop.OpenGL.WebGL15Context.arraY_POSITION=0;SystemEx.Interop.OpenGL.WebGL15Context.arraY_COLOR=1;SystemEx.Interop.OpenGL.WebGL15Context.arraY_TEXCOORD_0=2;SystemEx.Interop.OpenGL.WebGL15Context.arraY_TEXCOORD_1=3;SystemEx.Interop.OpenGL.WebGLES11RenderingContext.arraY_POSITION=0;SystemEx.Interop.OpenGL.WebGLES11RenderingContext.arraY_COLOR=1;SystemEx.Interop.OpenGL.WebGLES11RenderingContext.arraY_TEXCOORD_0=2;SystemEx.Interop.OpenGL.WebGLES11RenderingContext.arraY_TEXCOORD_1=3;}
ss.loader.registerScript('Script.WebGLES11',[core,Script.WebEx],executeScript);})();// This script was generated using Script# v0.7.4.0
